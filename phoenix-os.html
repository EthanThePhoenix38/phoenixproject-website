<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="apple-mobile-web-app-capable" content="yes">
<title>PhoenixOS v1.2.0</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:system-ui;background:linear-gradient(135deg,#667eea,#764ba2);height:100vh;overflow:hidden}
#desktop{height:100%;display:flex;flex-direction:column}
.menubar{height:28px;background:rgba(255,255,255,0.9);display:flex;align-items:center;padding:0 1rem;gap:1rem;font-size:13px}
.menubar-item{cursor:pointer;padding:0.5rem}
.menubar-right{margin-left:auto;display:flex;gap:1rem}
.dock{position:fixed;bottom:10px;left:50%;transform:translateX(-50%);background:rgba(255,255,255,0.3);backdrop-filter:blur(20px);padding:10px;border-radius:16px;display:flex;gap:10px}
.dock-item{width:60px;height:60px;background:rgba(255,255,255,0.9);border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:32px;cursor:pointer;transition:transform 0.2s}
.dock-item:hover{transform:translateY(-10px)}
.window{position:fixed;background:#fff;border-radius:8px;box-shadow:0 10px 40px rgba(0,0,0,0.3);display:none;flex-direction:column;min-width:400px;min-height:300px}
.window.show{display:flex}
.window-header{background:#f5f5f5;padding:10px;border-bottom:1px solid #ddd;display:flex;justify-content:space-between;align-items:center;cursor:move}
.window-title{font-weight:600;flex:1;text-align:center}
.window-controls{display:flex;gap:8px;position:absolute;left:10px}
.window-btn{width:12px;height:12px;border-radius:50%;cursor:pointer;border:1px solid #999}
.window-btn.close{background:#FF3B30}
.window-btn.minimize{background:#FFCC00}
.window-btn.maximize{background:#34C759}
.window-body{flex:1;padding:15px;overflow:auto}
.window-resize{position:absolute;bottom:0;right:0;width:20px;height:20px;cursor:nwse-resize}
@media (max-width:768px){
  .window{min-width:90vw!important;max-width:95vw!important}
  .dock{bottom:5px;padding:8px;gap:8px}
  .dock-item{width:50px;height:50px;font-size:28px}
}
.btn{padding:8px 16px;background:#007AFF;color:#fff;border:none;border-radius:6px;cursor:pointer;margin:5px}
.btn:hover{background:#0051D5}
input,textarea{width:100%;padding:8px;border:1px solid #ddd;border-radius:4px;margin:5px 0}
.file-list{list-style:none}
.file-item{padding:10px;border-bottom:1px solid #eee;cursor:pointer;display:flex;gap:10px}
.file-item:hover{background:#f9f9f9}
.terminal{background:#000;color:#0f0;font-family:monospace;padding:10px;height:100%;overflow-y:auto}
.terminal-line{margin:2px 0}
</style>
</head>
<body>
<div id="desktop">
  <div class="menubar">
    <div class="menubar-item" style="font-weight:700">üî• PhoenixOS</div>
    <div class="menubar-right">
      <div class="menubar-item" id="clock">00:00</div>
      <div class="menubar-item" style="cursor:pointer" onclick="location.reload()">‚èª</div>
    </div>
  </div>
  <div class="dock">
    <div class="dock-item" onclick="openFiles()">üìÅ</div>
    <div class="dock-item" onclick="openTerminal()">‚å®Ô∏è</div>
    <div class="dock-item" onclick="openEditor()">üìù</div>
    <div class="dock-item" onclick="openGames()">üéÆ</div>
  </div>
</div>
<script>
const FS = {
  getFiles() {
    const data = localStorage.getItem('files');
    return data ? JSON.parse(data) : [];
  },
  saveFiles(files) {
    localStorage.setItem('files', JSON.stringify(files));
  },
  create(name, content) {
    const files = this.getFiles();
    files.push({name, content, date: new Date().toISOString()});
    this.saveFiles(files);
  },
  read(name) {
    const files = this.getFiles();
    const file = files.find(f => f.name === name);
    return file ? file.content : '';
  },
  update(name, content) {
    const files = this.getFiles();
    const file = files.find(f => f.name === name);
    if (file) {
      file.content = content;
      this.saveFiles(files);
    }
  },
  delete(name) {
    let files = this.getFiles();
    files = files.filter(f => f.name !== name);
    this.saveFiles(files);
  },
  list() {
    return this.getFiles();
  }
};

let zIndex = 100;
function createWindow(title, content) {
  const win = document.createElement('div');
  win.className = 'window show';
  win.style.top = (50 + Math.random() * 100) + 'px';
  win.style.left = (50 + Math.random() * 100) + 'px';
  win.style.zIndex = ++zIndex;
  win.innerHTML = `
    <div class="window-header">
      <div class="window-controls">
        <div class="window-btn close"></div>
        <div class="window-btn minimize"></div>
        <div class="window-btn maximize"></div>
      </div>
      <div class="window-title">${title}</div>
    </div>
    <div class="window-body">${content}</div>
    <div class="window-resize"></div>
  `;

  // Close, minimize, maximize
  win.querySelector('.close').onclick = () => win.remove();
  win.querySelector('.minimize').onclick = () => win.style.display = 'none';
  win.querySelector('.maximize').onclick = () => {
    if (win.style.width === '90vw') {
      win.style.width = '600px';
      win.style.height = '400px';
      win.style.top = '100px';
      win.style.left = '100px';
    } else {
      win.style.width = '90vw';
      win.style.height = '85vh';
      win.style.top = '50px';
      win.style.left = '5vw';
    }
  };

  // Draggable
  const header = win.querySelector('.window-header');
  let isDragging = false, startX, startY, startLeft, startTop;

  header.addEventListener('mousedown', e => {
    isDragging = true;
    startX = e.clientX;
    startY = e.clientY;
    startLeft = win.offsetLeft;
    startTop = win.offsetTop;
    win.style.zIndex = ++zIndex;
  });

  document.addEventListener('mousemove', e => {
    if (!isDragging) return;
    win.style.left = (startLeft + e.clientX - startX) + 'px';
    win.style.top = (startTop + e.clientY - startY) + 'px';
  });

  document.addEventListener('mouseup', () => isDragging = false);

  // Resizable
  const resizeHandle = win.querySelector('.window-resize');
  let isResizing = false;

  resizeHandle.addEventListener('mousedown', e => {
    isResizing = true;
    startX = e.clientX;
    startY = e.clientY;
    startLeft = win.offsetWidth;
    startTop = win.offsetHeight;
    e.stopPropagation();
  });

  document.addEventListener('mousemove', e => {
    if (!isResizing) return;
    const newWidth = startLeft + (e.clientX - startX);
    const newHeight = startTop + (e.clientY - startY);
    if (newWidth > 300) win.style.width = newWidth + 'px';
    if (newHeight > 200) win.style.height = newHeight + 'px';
  });

  document.addEventListener('mouseup', () => isResizing = false);

  document.body.appendChild(win);
  return win.querySelector('.window-body');
}

function openFiles() {
  const body = createWindow('Files', '');
  body.innerHTML = '<button class="btn" onclick="createNewFile()">New File</button><ul class="file-list" id="fileList"></ul>';
  updateFileList();
}

function updateFileList() {
  const list = document.getElementById('fileList');
  if (!list) return;
  list.innerHTML = '';
  FS.list().forEach(file => {
    const li = document.createElement('li');
    li.className = 'file-item';
    li.innerHTML = `
      <span>üìÑ</span>
      <span style="flex:1">${file.name}</span>
      <button class="btn" style="padding:4px 8px;margin:0" onclick="openEditor('${file.name}')">Open</button>
      <button class="btn" style="padding:4px 8px;margin:0;background:red" onclick="deleteFile('${file.name}')">Del</button>
    `;
    list.appendChild(li);
  });
}

function createNewFile() {
  const name = prompt('File name:');
  if (name) {
    FS.create(name, '');
    updateFileList();
  }
}

function deleteFile(name) {
  if (confirm('Delete ' + name + '?')) {
    FS.delete(name);
    updateFileList();
  }
}

function openEditor(filename) {
  const body = createWindow('Editor', '');
  const content = filename ? FS.read(filename) : '';
  body.innerHTML = `
    <input type="text" id="editorName" placeholder="File name" value="${filename || ''}">
    <textarea id="editorText" style="height:300px;font-family:monospace">${content}</textarea>
    <button class="btn" onclick="saveFile()">Save</button>
  `;
  window.currentEditor = body;
}

function saveFile() {
  const name = document.getElementById('editorName').value;
  const content = document.getElementById('editorText').value;
  if (!name) {
    alert('Enter a file name!');
    return;
  }
  if (FS.list().find(f => f.name === name)) {
    FS.update(name, content);
  } else {
    FS.create(name, content);
  }
  alert('Saved!');
  updateFileList();
}

function openTerminal() {
  const body = createWindow('Terminal', '');
  body.innerHTML = `
    <div class="terminal" id="termOutput">
      <div class="terminal-line">PhoenixOS Terminal v1.2.0</div>
      <div class="terminal-line">Type 'help' for commands</div>
    </div>
    <input type="text" id="termInput" placeholder="$" style="background:#000;color:#0f0;font-family:monospace">
  `;

  const input = document.getElementById('termInput');
  const output = document.getElementById('termOutput');

  input.addEventListener('keypress', e => {
    if (e.key !== 'Enter') return;
    const cmd = input.value.trim();
    input.value = '';

    const line = document.createElement('div');
    line.className = 'terminal-line';
    line.textContent = '$ ' + cmd;
    output.appendChild(line);

    if (!cmd) return;

    const parts = cmd.split(' ');
    let response = '';

    switch(parts[0]) {
      case 'help':
        response = 'Commands: help, clear, ls, cat <file>, date, echo <text>';
        break;
      case 'clear':
        output.innerHTML = '';
        return;
      case 'ls':
        response = FS.list().map(f => f.name).join('\n') || 'No files';
        break;
      case 'cat':
        if (parts[1]) {
          response = FS.read(parts[1]) || 'File not found';
        } else {
          response = 'Usage: cat <filename>';
        }
        break;
      case 'date':
        response = new Date().toString();
        break;
      case 'echo':
        response = parts.slice(1).join(' ');
        break;
      default:
        response = 'Command not found: ' + parts[0];
    }

    const respLine = document.createElement('div');
    respLine.className = 'terminal-line';
    respLine.textContent = response;
    output.appendChild(respLine);
    output.scrollTop = output.scrollHeight;
  });

  input.focus();
}

function openGames() {
  const body = createWindow('Games', '');
  body.innerHTML = `
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
      <button class="btn" onclick="playSnake()">üêç Snake</button>
      <button class="btn" onclick="playPong()">üèì Pong</button>
    </div>
  `;
}

function playSnake() {
  const body = createWindow('Snake', '');
  body.innerHTML = `
    <div style="text-align:center">
      <div id="snakeScore">Score: 0</div>
      <canvas id="snakeCanvas" width="400" height="400" style="border:2px solid #000;background:#000"></canvas>
      <div>Use arrow keys</div>
    </div>
  `;

  const canvas = document.getElementById('snakeCanvas');
  const ctx = canvas.getContext('2d');
  const grid = 20;
  let snake = [{x: 10, y: 10}];
  let dir = {x: 1, y: 0};
  let food = {x: 15, y: 15};
  let score = 0;

  document.addEventListener('keydown', e => {
    if (e.key === 'ArrowUp' && dir.y === 0) dir = {x: 0, y: -1};
    if (e.key === 'ArrowDown' && dir.y === 0) dir = {x: 0, y: 1};
    if (e.key === 'ArrowLeft' && dir.x === 0) dir = {x: -1, y: 0};
    if (e.key === 'ArrowRight' && dir.x === 0) dir = {x: 1, y: 0};
  });

  const gameLoop = setInterval(() => {
    const head = {x: snake[0].x + dir.x, y: snake[0].y + dir.y};

    if (head.x < 0 || head.x >= 20 || head.y < 0 || head.y >= 20 ||
        snake.some(s => s.x === head.x && s.y === head.y)) {
      clearInterval(gameLoop);
      alert('Game Over! Score: ' + score);
      return;
    }

    snake.unshift(head);

    if (head.x === food.x && head.y === food.y) {
      score++;
      document.getElementById('snakeScore').textContent = 'Score: ' + score;
      food = {
        x: Math.floor(Math.random() * 20),
        y: Math.floor(Math.random() * 20)
      };
    } else {
      snake.pop();
    }

    ctx.fillStyle = '#000';
    ctx.fillRect(0, 0, 400, 400);
    ctx.fillStyle = '#0f0';
    snake.forEach(s => ctx.fillRect(s.x * grid, s.y * grid, grid - 2, grid - 2));
    ctx.fillStyle = '#f00';
    ctx.fillRect(food.x * grid, food.y * grid, grid - 2, grid - 2);
  }, 150);
}

function playPong() {
  const body = createWindow('Pong', '');
  body.innerHTML = `
    <div style="text-align:center">
      <div id="pongScore">0 - 0</div>
      <canvas id="pongCanvas" width="400" height="400" style="border:2px solid #000;background:#000"></canvas>
      <div>Move mouse to control</div>
    </div>
  `;

  const canvas = document.getElementById('pongCanvas');
  const ctx = canvas.getContext('2d');
  let ball = {x: 200, y: 200, dx: 3, dy: 3};
  let p1 = {y: 160, score: 0};
  let p2 = {y: 160, score: 0};

  canvas.addEventListener('mousemove', e => {
    const rect = canvas.getBoundingClientRect();
    p1.y = e.clientY - rect.top - 40;
  });

  const gameLoop = setInterval(() => {
    ball.x += ball.dx;
    ball.y += ball.dy;

    if (ball.y < 0 || ball.y > 390) ball.dy *= -1;
    if (ball.x < 20 && ball.y > p1.y && ball.y < p1.y + 80) ball.dx *= -1;
    if (ball.x > 370 && ball.y > p2.y && ball.y < p2.y + 80) ball.dx *= -1;

    if (ball.x < 0) {
      p2.score++;
      ball = {x: 200, y: 200, dx: 3, dy: 3};
      document.getElementById('pongScore').textContent = p1.score + ' - ' + p2.score;
    }
    if (ball.x > 400) {
      p1.score++;
      ball = {x: 200, y: 200, dx: -3, dy: 3};
      document.getElementById('pongScore').textContent = p1.score + ' - ' + p2.score;
    }

    p2.y += (ball.y - p2.y - 40) * 0.1;

    ctx.fillStyle = '#000';
    ctx.fillRect(0, 0, 400, 400);
    ctx.fillStyle = '#fff';
    ctx.fillRect(10, p1.y, 10, 80);
    ctx.fillRect(380, p2.y, 10, 80);
    ctx.beginPath();
    ctx.arc(ball.x, ball.y, 5, 0, Math.PI * 2);
    ctx.fill();
  }, 1000/60);
}

setInterval(() => {
  document.getElementById('clock').textContent = new Date().toLocaleTimeString('fr-FR', {hour:'2-digit', minute:'2-digit'});
}, 1000);
</script>
</body>
</html>
